<!-- 
    this is the fugliest file you will ever encounter 
    may the webdev-gods be with you
-->

<!DOCTYPE html>
<html>

    <head>
        <title>mmjs remote</title>
        <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.2/css/bulma.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" referrerpolicy="no-referrer" />
    </head>

    <body>
        <div id="app"></div>
    </body>

    <!-- the entire vue application including template -->
    <script>
        var mySimpleApp = new Vue({
            el: '#app',
            template: `
            <div id="app-wrapper">

                <table class="table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>Artist</th>
                            <th>Title</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="i, key of tracks">
                            <td v-if="index === key"><i class="fa fa-chevron-circle-right" aria-hidden="true"></i></td>
                            <td v-else></td>
                            <td v-if="i.Artist.Valid">{{i.Artist.String}}</td>
                            <td v-else>unknown</td>
                            <td v-if="i.Title.Valid">{{i.Title.String}}</td>
                            <td v-else>unknown</td>
                        </tr>
                    </tbody>
                </table>

                <div id="controls">
                    <div id="previous" class="control-button" @click="previous">
                        <i class="fas fa-step-backward"></i>
                    </div>
                    <div v-if="playing" id="pause" class="control-button" @click="pause">
                        <i class="fas fa-pause"></i>
                    </div>
                    <div v-else id="play" class="control-button" @click="play">
                        <i class="fas fa-play"></i>
                    </div>
                    <div id="next" class="control-button" @click="next">
                        <i class="fas fa-step-forward"></i>
                    </div>
                </div>

            </div>
            `,
            data() {
                return {
                    tracks: [],
                    playing: false,
                    index: 0,
                    commandsocket: null,
                    statsocket: null
                }
            },
            mounted(){
                this.commandsocket = new WebSocket("ws://localhost:8081/commands");
                this.statsocket = new WebSocket("ws://localhost:8081/stats");

                this.statsocket.onmessage = (e) => {
                    let stats = JSON.parse(e.data)
                    console.log(stats.Playing)
                    this.tracks = stats.Queue
                    this.index = stats.Index
                    this.playing = stats.Playing
                };
            },
            methods: {
                pause(){
                    this.commandsocket.send('pause')
                },
                play(){
                    this.commandsocket.send('play')
                },
                previous(){
                    this.commandsocket.send('previous')
                },
                next(){
                    this.commandsocket.send('next')
                }
            }
        })
    </script>

    <style>
        .table{
            width: 100%;
        }

        #controls{
            background-color: #80090c;
            position: fixed;
            width: 100%;
            height: 100px;
            bottom: 0px;
        }

        .control-button{
            display: inline;
            font-size: 65px;
            padding-left: 15px;
            color: white;
            /* background-color: #cb2821; */
            margin-top: 10px;
            margin-right: 20px;
            border-radius: 10px;
            cursor: pointer;
        }
    </style>

</html>